# æ·»åŠ æ•°æ®æ¥æºæ˜¾ç¤ºçš„ä¿®å¤æ–¹æ¡ˆ

## é—®é¢˜ç¡®è®¤

âœ… **å·²ç¡®è®¤**: æœ€ç»ˆçš„åˆ†ææŠ¥å‘Šï¼ˆå¦‚`news_report.md`ï¼‰ä¸­**æ²¡æœ‰æ˜¾ç¤ºæ•°æ®æ¥æºä¿¡æ¯**

### è¯æ®
1. æœç´¢`src/01810_reports/*.md`ä¸­çš„"æ•°æ®æ¥æº"å…³é”®å­— â†’ æ— ç»“æœ
2. `unified_news_tool.py`çš„`_format_news_result()`å‡½æ•°æœ‰æ•°æ®æ¥æºæ ¼å¼åŒ–
3. ä½†è¿™ä¸ªæ ¼å¼åŒ–ç»“æœ**æ²¡æœ‰è¢«ä¼ é€’åˆ°æœ€ç»ˆçš„AgentæŠ¥å‘Šä¸­**

---

## æ ¹æœ¬åŸå› 

### æ•°æ®æµç¨‹åˆ†æ

```
1. unified_news_tool.get_stock_news_unified()
   â†“ è¿”å›æ ¼å¼åŒ–çš„æ–°é—»å†…å®¹ï¼ˆåŒ…å«æ•°æ®æ¥æºï¼‰
   
2. social_media_analyst / news_analyst
   â†“ æ¥æ”¶æ–°é—»å†…å®¹ä½œä¸ºå·¥å…·è°ƒç”¨ç»“æœ
   â†“ ä½¿ç”¨LLMç”Ÿæˆåˆ†ææŠ¥å‘Š
   
3. LLMç”Ÿæˆçš„æœ€ç»ˆæŠ¥å‘Š
   â†“ **æ•°æ®æ¥æºä¿¡æ¯ä¸¢å¤±äº†ï¼**
   
4. ä¿å­˜åˆ° news_report.md
   âœ— æ²¡æœ‰æ•°æ®æ¥æºä¿¡æ¯
```

### é—®é¢˜æ‰€åœ¨

**LLMåœ¨ç”ŸæˆæŠ¥å‘Šæ—¶ï¼Œæ²¡æœ‰è¢«è¦æ±‚ä¿ç•™æ•°æ®æ¥æºä¿¡æ¯**

---

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ä¿®æ”¹Agentçš„System Prompt â­ æ¨è

#### å®æ–½ä½ç½®
`src/tradingagents/agents/analysts/news_analyst.py`
`src/tradingagents/agents/analysts/social_media_analyst.py`

#### ä¿®æ”¹å†…å®¹

åœ¨system promptä¸­æ·»åŠ æ˜ç¡®è¦æ±‚ï¼š

```python
system_message = """
æ‚¨æ˜¯ä¸€ä½ä¸“ä¸šçš„è´¢ç»æ–°é—»åˆ†æå¸ˆ...

ğŸ“‹ **æŠ¥å‘Šæ ¼å¼è¦æ±‚**ï¼š

1. æŠ¥å‘Šå¿…é¡»åœ¨**æœ«å°¾**æ·»åŠ "æ•°æ®æ¥æº"ç« èŠ‚
2. æ ¼å¼å¦‚ä¸‹ï¼š

---

## ğŸ“Š æ•°æ®æ¥æº

æœ¬æŠ¥å‘ŠåŸºäºä»¥ä¸‹æ•°æ®æºï¼š

{åœ¨è¿™é‡Œåˆ—å‡ºå·¥å…·è¿”å›çš„æ‰€æœ‰æ•°æ®æ¥æº}

---

3. æ•°æ®æ¥æºä¿¡æ¯å¯ä»¥ä»å·¥å…·è¿”å›çš„å†…å®¹ä¸­æå–
4. ç¤ºä¾‹æ ¼å¼ï¼š

---

## ğŸ“Š æ•°æ®æ¥æº

æœ¬æŠ¥å‘ŠåŸºäºä»¥ä¸‹æ•°æ®æºçš„ç»¼åˆåˆ†æï¼š

- âœ… **ä¸œæ–¹è´¢å¯Œ** - ä¸ªè‚¡å®æ—¶æ–°é—»
- âœ… **Playwrightçˆ¬è™«** - ç½‘é¡µæŠ“å–
- âœ… **å¤šæºå¿«è®¯** - AKShareèšåˆ
- âœ… **Serper** - Googleæœç´¢
- âœ… **yfinance** - Yahoo Financeï¼ˆ10æ¡æ–°é—»ï¼‰

ğŸ“… æ•°æ®è·å–æ—¶é—´: 2026-01-24 14:30:00
ğŸ“ æ€»æ•°æ®é‡: 15,234 å­—ç¬¦

---

**é‡è¦**: å¿…é¡»åœ¨æŠ¥å‘Šæœ«å°¾æ·»åŠ æ­¤ç« èŠ‚ï¼Œè®©ç”¨æˆ·çŸ¥é“åˆ†æåŸºäºå“ªäº›æ•°æ®æºã€‚
"""
```

---

### æ–¹æ¡ˆ2: åœ¨å·¥å…·è¿”å›æ—¶æ·»åŠ å…ƒæ•°æ®æ ‡è®°

#### å®æ–½ä½ç½®
`src/tradingagents/tools/unified_news_tool.py`

#### ä¿®æ”¹å†…å®¹

åœ¨`_format_news_result()`ä¸­æ·»åŠ æ˜æ˜¾çš„æ ‡è®°ï¼š

```python
def _format_news_result(self, news_content: str, source: str, model_info: str = "") -> str:
    """æ ¼å¼åŒ–æ–°é—»ç»“æœ"""
    timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    
    # åœ¨å¼€å¤´æ·»åŠ é†’ç›®çš„æ•°æ®æ¥æºæ ‡è®°
    formatted_result = f"""
{'='*60}
ğŸ“Š æ•°æ®æ¥æºä¿¡æ¯ - è¯·åœ¨æœ€ç»ˆæŠ¥å‘Šä¸­ä¿ç•™æ­¤ä¿¡æ¯
{'='*60}

æ•°æ®æ¥æº: {source}
è·å–æ—¶é—´: {timestamp}
æ•°æ®é•¿åº¦: {len(news_content)} å­—ç¬¦

âš ï¸ é‡è¦æç¤ºï¼šè¯·åœ¨ç”Ÿæˆçš„åˆ†ææŠ¥å‘Šæœ«å°¾æ·»åŠ "æ•°æ®æ¥æº"ç« èŠ‚ï¼Œ
åˆ—å‡ºæœ¬æ¬¡åˆ†æä½¿ç”¨çš„æ‰€æœ‰æ•°æ®æºã€‚

{'='*60}

{news_content}

{'='*60}
ğŸ“Š æ•°æ®æ¥æºæ€»ç»“
{'='*60}
æ¥æº: {source}
æ—¶é—´: {timestamp}
çŠ¶æ€: âœ… æˆåŠŸè·å–
{'='*60}
"""
    return formatted_result.strip()
```

---

### æ–¹æ¡ˆ3: åœ¨æŠ¥å‘Šç”Ÿæˆåè‡ªåŠ¨è¿½åŠ æ•°æ®æ¥æº

#### å®æ–½ä½ç½®
`src/tradingagents/agents/analysts/news_analyst.py`

#### ä¿®æ”¹å†…å®¹

åœ¨ç”ŸæˆæŠ¥å‘Šåï¼Œè‡ªåŠ¨è¿½åŠ æ•°æ®æ¥æºä¿¡æ¯ï¼š

```python
def news_analyst_node(state):
    # ... ç°æœ‰ä»£ç  ...
    
    # ç”ŸæˆæŠ¥å‘Š
    report = result.content
    
    # ğŸ”§ è‡ªåŠ¨è¿½åŠ æ•°æ®æ¥æºä¿¡æ¯
    sources_info = _extract_sources_from_messages(state["messages"])
    if sources_info:
        data_sources_section = f"""

---

## ğŸ“Š æ•°æ®æ¥æº

æœ¬æŠ¥å‘ŠåŸºäºä»¥ä¸‹æ•°æ®æºçš„ç»¼åˆåˆ†æï¼š

{sources_info}

ğŸ“… æ•°æ®è·å–æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}

---
"""
        report += data_sources_section
    
    return {"messages": [AIMessage(content=report)]}

def _extract_sources_from_messages(messages):
    """ä»æ¶ˆæ¯ä¸­æå–æ•°æ®æ¥æºä¿¡æ¯"""
    sources = []
    for msg in messages:
        if isinstance(msg, ToolMessage):
            content = str(msg.content)
            # æå–æ•°æ®æ¥æºä¿¡æ¯
            if "æ•°æ®æ¥æº:" in content:
                # è§£ææ•°æ®æ¥æº
                lines = content.split('\n')
                for line in lines:
                    if "æ•°æ®æ¥æº:" in line or "æ¥æº:" in line:
                        source = line.split(':')[1].strip()
                        if source not in sources:
                            sources.append(source)
    
    if sources:
        return '\n'.join([f"- âœ… **{source}**" for source in sources])
    return None
```

---

## æ¨èå®æ–½æ–¹æ¡ˆ

### ç¬¬ä¸€æ­¥: ä¿®æ”¹System Promptï¼ˆæ–¹æ¡ˆ1ï¼‰

**ä¼˜ç‚¹**:
- å®æ–½ç®€å•
- ä¸æ”¹å˜ç°æœ‰æ•°æ®æµ
- LLMä¼šè‡ªåŠ¨æå–å’Œæ ¼å¼åŒ–æ•°æ®æ¥æº

**å®æ–½ä»£ç **:

```python
# åœ¨ news_analyst.py å’Œ social_media_analyst.py ä¸­

system_message = """
æ‚¨æ˜¯ä¸€ä½ä¸“ä¸šçš„è´¢ç»æ–°é—»åˆ†æå¸ˆ...

ğŸ“‹ **æŠ¥å‘Šæ ¼å¼è¦æ±‚**ï¼š

1. æŠ¥å‘Šç»“æ„ï¼š
   - æ ‡é¢˜
   - æ ¸å¿ƒåˆ†æå†…å®¹
   - **æ•°æ®æ¥æºç« èŠ‚ï¼ˆå¿…é¡»ï¼‰**

2. æ•°æ®æ¥æºç« èŠ‚æ ¼å¼ï¼š

---

## ğŸ“Š æ•°æ®æ¥æº

æœ¬æŠ¥å‘ŠåŸºäºä»¥ä¸‹æ•°æ®æºï¼š

ï¼ˆä»å·¥å…·è¿”å›çš„å†…å®¹ä¸­æå–æ•°æ®æ¥æºä¿¡æ¯ï¼Œåˆ—å‡ºæ‰€æœ‰ä½¿ç”¨çš„æ•°æ®æºï¼‰

ç¤ºä¾‹ï¼š
- âœ… **ä¸œæ–¹è´¢å¯Œ** - ä¸ªè‚¡æ–°é—»
- âœ… **yfinance** - Yahoo Financeæ–°é—»
- âœ… **Serper** - Googleæœç´¢

---

3. **é‡è¦**: æ­¤ç« èŠ‚å¿…é¡»å‡ºç°åœ¨æŠ¥å‘Šæœ«å°¾ï¼Œè®©ç”¨æˆ·äº†è§£åˆ†æçš„æ•°æ®åŸºç¡€ã€‚
"""
```

### ç¬¬äºŒæ­¥: å¦‚æœæ–¹æ¡ˆ1æ•ˆæœä¸å¥½ï¼Œä½¿ç”¨æ–¹æ¡ˆ3

è‡ªåŠ¨è¿½åŠ æ•°æ®æ¥æºä¿¡æ¯ï¼Œç¡®ä¿100%æ˜¾ç¤ºã€‚

---

## é¢„æœŸæ•ˆæœ

### ä¿®å¤å‰
```markdown
# å°ç±³é›†å›¢-W (01810.HK) æ–°é—»ä¸èµ„é‡‘é¢æ·±åº¦åˆ†ææŠ¥å‘Š

...ï¼ˆåˆ†æå†…å®¹ï¼‰...

**æ€»ç»“**: å°ç±³é›†å›¢æ­£å¤„äº...
```
âŒ ç”¨æˆ·ä¸çŸ¥é“æ•°æ®æ¥è‡ªå“ªé‡Œ

### ä¿®å¤å
```markdown
# å°ç±³é›†å›¢-W (01810.HK) æ–°é—»ä¸èµ„é‡‘é¢æ·±åº¦åˆ†ææŠ¥å‘Š

...ï¼ˆåˆ†æå†…å®¹ï¼‰...

**æ€»ç»“**: å°ç±³é›†å›¢æ­£å¤„äº...

---

## ğŸ“Š æ•°æ®æ¥æº

æœ¬æŠ¥å‘ŠåŸºäºä»¥ä¸‹æ•°æ®æºçš„ç»¼åˆåˆ†æï¼š

- âœ… **ä¸œæ–¹è´¢å¯Œ** - ä¸ªè‚¡å®æ—¶æ–°é—»
- âœ… **Playwrightçˆ¬è™«** - ç½‘é¡µæŠ“å–
- âœ… **å¤šæºå¿«è®¯** - AKShareèšåˆ
- âœ… **Serper** - Googleæœç´¢
- âœ… **yfinance** - Yahoo Financeï¼ˆ10æ¡æ–°é—»ï¼‰

ğŸ“… æ•°æ®è·å–æ—¶é—´: 2026-01-24 14:30:00
ğŸ“ æ€»æ•°æ®é‡: 15,234 å­—ç¬¦

---
```
âœ… ç”¨æˆ·æ¸…æ¥šçŸ¥é“ä½¿ç”¨äº†å“ªäº›æ•°æ®æºï¼ŒåŒ…æ‹¬yfinance

---

## æ€»ç»“

**é—®é¢˜**: æœ€ç»ˆæŠ¥å‘Šä¸­æ²¡æœ‰æ˜¾ç¤ºæ•°æ®æ¥æºä¿¡æ¯

**åŸå› **: LLMç”ŸæˆæŠ¥å‘Šæ—¶æ²¡æœ‰è¢«è¦æ±‚ä¿ç•™æ•°æ®æ¥æº

**è§£å†³**: ä¿®æ”¹Agentçš„system promptï¼Œæ˜ç¡®è¦æ±‚åœ¨æŠ¥å‘Šæœ«å°¾æ·»åŠ æ•°æ®æ¥æºç« èŠ‚

**æ•ˆæœ**: ç”¨æˆ·èƒ½çœ‹åˆ°æ‰€æœ‰ä½¿ç”¨çš„æ•°æ®æºï¼ŒåŒ…æ‹¬yfinanceç­‰
