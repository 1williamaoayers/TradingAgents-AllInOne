# TradingAgents 项目核心工作流程总结

📅 **创建时间**: 2026-01-23  
🎯 **目的**: 用最简单的语言解释项目的数据处理流程

---

## 🚀 核心流程（一句话版本）

**AI叫工具去14个网站抓新闻，拿到真实数据，然后把数据塞进提示词，最后基于真实新闻写分析报告。**

---

## 📋 详细流程分解

### 第1步：AI收到任务（无数据）
```
提示词: "你是新闻分析师，分析股票01810.HK"
注意：此时没有任何新闻数据！
```

### 第2步：AI决定调用工具
```
AI推理: "我需要新闻数据"
AI行动: 调用 get_stock_news_unified("01810.HK")
```

### 第3步：工具去14个网站抓数据
**代码位置**: `unified_news_tool.py` 第899-1060行

工具自动访问：
1. 东方财富API
2. AKShare多源快讯（7个子源）
3. Serper实时搜索
4. RSS聚合（7个子源）
5. MongoDB缓存
6. ...等等

**真实网络请求，实时获取最新数据！**

### 第4步：工具返回真实数据
**代码位置**: `news_analyst.py` 第376-382行

```python
forced_news_result = unified_news_tool(stock_code=ticker, max_news=36)
forced_news = forced_news_result.get("content", "")

# 返回示例（45230字符，1135条新闻）:
# "=== 股票新闻汇总 ===
#  【东方财富】小米汽车销量突破10万辆
#  【财联社】小米集团股价上涨3%
#  【格隆汇】港股通买入小米5.2亿
#  ..."
```

### 第5步：数据动态注入提示词
**代码位置**: `news_analyst.py` 第391-401行

```python
forced_prompt = f"""
您是一位专业的财经新闻分析师。

=== 最新新闻数据 ===
{forced_news}  # ← 工具刚刚抓回来的真实数据

请基于上述真实新闻数据撰写分析报告。
"""
```

### 第6步：AI基于真实数据写报告
```
AI看到真实新闻后:
"根据这1135条新闻，小米汽车销量突破是重大利好，
 南向资金大额买入显示机构看好，
 综合判断：强烈看涨！"
```

---

## 🔑 核心区别

### ❌ 简单系统的做法
```
提前抓好所有数据 → 填充到固定模板 → AI写报告
```

### ✅ 这个项目的做法
```
AI推理需要什么数据 → 动态调用工具获取 → 基于实时数据分析
```

---

## 💡 关键技术点

| 技术 | 作用 | 代码位置 |
|:---|:---|:---|
| **ReAct模式** | AI自主决定调用工具 | `trading_graph.py` L14 |
| **LangGraph** | 管理多智能体工作流 | `setup.py` L199-205 |
| **ToolNode** | 工具调用管理 | `news_analyst.py` L328 |
| **统一新闻工具** | 聚合14个数据源 | `unified_news_tool.py` L899-1060 |
| **动态提示词** | 数据运行时注入 | `news_analyst.py` L391-401 |

---

## 🎯 一句话总结（最终版）

**这不是"填空题"，而是AI自己决定去哪里找数据、找什么数据、怎么分析数据的"自主调查员"系统！**

---

## 📚 相关文档

- 详细架构：查看 `CLI系统使用说明.md`
- 数据源说明：查看 `港股新闻数据源结构.md`
- 代码位置：查看上述各个文件的具体行号
