trigger: always_on
alwaysApply: true
---
# 🧬 绝对指令 (v5.1 Kernel)

## 0. 语言锁 (LANGUAGE LOCK)
- **所有产出必须是中文**。
- 每次输出前说：“这是中文吗？”

## 1. 启动协议 (START PROTOCOL)
- **触发**: 新对话 / "开始" / "继续"
- **执行**: `view_file .agent/workflows/start.md`
- **严禁**: 跳过开工仪式直接干活。

## 2. 双核记忆锁 (DUAL MEMORY LOCK)
- **TODO.md** (User View): 秒级同步。
- **notes.md** (Agent View): 记录过程。

### 6. 🛡️ 工具安全协议 (TOOL SAFETY)
- **禁止终端写入**: 严禁使用 `run_command` 执行 `Add-Content`, `echo`, `printf` 等写入文件的操作。
- **强制原生工具**: 必须使用 `write_to_file` 或 `replace_file_content` 进行文件修改。
- **原因**: 终端写入会触发安全弹窗，打断用户心流。违者必究。

### 7. ⏳ 防卡死协议 (ANTI-FREEZE)
### 7. ⏳ 防卡死协议 (ANTI-FREEZE)
**核心原则**: 放弃主观预测，强制执行**分批标准 (Batch Standards)**。
1.  **阅读限制**: 单次工具调用不得超过 **3个文件** 或 **800行**。
2.  **写入限制**: 单次修改仅限 **1个核心逻辑块**。
3.  **运行监控 (Active Monitor)**:
    *   高危命令必须后台运行 (`WaitMs < 3000`).
    *   **严禁盲目等待**: 必须每 5-10 秒通过 `command_status` 轮询。
    *   **防僵死 (Anti-Zombie)**: 若 Status=RUNNING 且 >180s 无输出，**必须先读取最后10行日志分析原因**（如: 下载慢/编译中/死锁），然后向用户汇报："已卡顿3分钟，疑似原因[XXX]，是否继续？"。禁止只问不查。
4.  **搜索限制**: 禁止全盘搜索，必须指定具体 `Directory` 或 `file pattern`。
**违规处置**: 只要操作超出上述标准，**必须**先执行 `long-task.md` 进行拆解。
- **铁律**: 先改 TODO，再动手 (Update First, Then Act)。

## 3. 验证锁 (VERIFICATION LOCK)
- **禁止**将来时 / 无证据打勾。
- **必须**拿到 Log/Screenshot。

## 4. 存档协议 (END PROTOCOL)
- **触发**: "暂停" / "下班" / "存档"
- **执行**: `view_file .agent/workflows/session-handover.md`

## 5. 工具箱导航 (WORKFLOW ROUTING)
遇到复杂任务，**优先**执行对应工作流：
- **提交/发布** → `.agent/workflows/deploy.md` (用户指令: "提交")
- **测试/验证** → `.agent/workflows/test-verification.md`
- **重置/纠错** → `.agent/workflows/reset.md`
- **违规/反省** → `.agent/workflows/rule.md`
- **记录/知识** → `.agent/workflows/memory-system.md` (用户指令: "记录")
- **收工/存档** → `.agent/workflows/session-handover.md` (用户指令: "收工")
