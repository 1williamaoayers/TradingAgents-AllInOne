# TradingAgentsæ–°é—»æ•°æ®æµç¨‹æ¶æ„è¯´æ˜

> åˆ›å»ºæ—¶é—´ï¼š2026-01-18 20:21  
> é—®é¢˜æ¥æºï¼šç”¨æˆ·è¯¢é—®æ–°é—»æ•°æ®é‡‡é›†çš„å·¥ä½œæµç¨‹

---

## ğŸ“‹ ç”¨æˆ·é—®é¢˜

**é—®é¢˜**ï¼šæœ‰ä¸ªé—®é¢˜ï¼Œæ˜¯æˆ‘æœ‰tradingagentså‰ç«¯è¾“å…¥ å°ç±³é›†å›¢ è¿›è¡Œåˆ†ææ—¶ï¼Œåç«¯å°±ä¼šå³æ—¶è°ƒç”¨å…¶ä»–6ä¸ªæ•°æ®å±‚ï¼ˆè¿™ä¸ªæˆ‘ä¸è®°å¾—äº†ï¼‰+çˆ¬è™«è·å¾—æ•°æ®ï¼Œè£…å¡«è¿›æç¤ºè¯ç»™llmç”ŸæˆæŠ¥å‘Šå‘¢ï¼Œè¿˜æ˜¯çˆ¬è™«æ•°æ®åªè¿›å…¥æ•°æ®åº“ã€‚

---

## ğŸ“Š ç­”æ¡ˆï¼š**å³æ—¶è°ƒç”¨ï¼Œå®æ—¶è·å–**

### ğŸ¯ æ ¸å¿ƒç»“è®º

å½“ä½ åœ¨TradingAgentså‰ç«¯è¾“å…¥"å°ç±³é›†å›¢"è¿›è¡Œåˆ†ææ—¶ï¼Œåç«¯ä¼š**å³æ—¶è°ƒç”¨å¤šä¸ªæ•°æ®æº**ï¼ˆåŒ…æ‹¬çˆ¬è™«ï¼‰ï¼Œå®æ—¶è·å–æ–°é—»æ•°æ®è£…å¡«è¿›æç¤ºè¯ç»™LLMç”ŸæˆæŠ¥å‘Šã€‚

---

## ğŸ” å…·ä½“æµç¨‹ï¼ˆæŸ¥çœ‹ä»£ç è¯å®ï¼‰

### ğŸ“Œ **6ä¸ªæ•°æ®å±‚å¹¶è¡Œè°ƒç”¨**ï¼ˆæ¸¯è‚¡ç¤ºä¾‹ï¼‰

æ ¹æ® `unified_news_tool.py` L813-950ï¼ˆæ¸¯è‚¡æ–°é—»è·å–å‡½æ•°ï¼‰ï¼Œå½“ä½ åˆ†ææ¸¯è‚¡"å°ç±³é›†å›¢"(01810.HK)æ—¶ï¼Œç³»ç»Ÿä¼š**å¹¶è¡Œè°ƒç”¨6ä¸ªæ•°æ®æº**ï¼š

#### 1. **ä¸œæ–¹è´¢å¯Œä¸ªè‚¡æ–°é—»**ï¼ˆL830-853ï¼‰- **å³æ—¶è°ƒç”¨**
```python
provider.stock_news_em(symbol=clean_code)  # å®æ—¶é‡‡é›†
```

#### 2. **AKShareå¤šæºè´¢ç»å¿«è®¯**ï¼ˆL855-866ï¼‰- **å³æ—¶è°ƒç”¨**
```python
provider.get_multi_source_news(limit_per_source=5)  # å®æ—¶èšåˆ
```

#### 3. **Serperå®æ—¶æœç´¢**ï¼ˆL868-878ï¼‰- **å³æ—¶è°ƒç”¨**
```python
self._search_news_with_serper(query, period="qdr:d")  # Googleæœç´¢
```

#### 4. **Alpha Vantage**ï¼ˆL880-898ï¼‰- **å³æ—¶è°ƒç”¨**ï¼ˆä»…ç¾è‚¡ï¼‰
```python
get_alpha_vantage_news(ticker=stock_code, limit=10)
```

#### 5. **RSSæ–°é—»æº**ï¼ˆL900-937ï¼‰- **å³æ—¶è°ƒç”¨**
```python
rss_adapter.get_news(symbol=stock_code, limit=15)  # é‡‘åã€è´¢è”ç¤¾ç­‰
```

#### 6. **æ•°æ®åº“å†å²ç¼“å­˜**ï¼ˆL939-948ï¼‰- **æŸ¥è¯¢æ•°æ®åº“**
```python
self._get_news_from_database(stock_code, 15, company_name)  # å†å²æ•°æ®
```

---

## ğŸ¤– **çˆ¬è™«æ•°æ®çš„ä¸¤ç§å»å¤„**

### 1ï¸âƒ£ **å³æ—¶ä½¿ç”¨**ï¼ˆä¸»è¦è·¯å¾„ï¼‰âœ…

- å½“ä½ ç‚¹å‡»"åˆ†æ"æ—¶ï¼Œç³»ç»Ÿ**ç«‹å³è°ƒç”¨**çˆ¬è™«APIï¼ˆplaywriteOCRçš„9527ç«¯å£ï¼‰
- çˆ¬è™«è¿”å›çš„æ•°æ®**ç›´æ¥è£…å¡«è¿›æç¤ºè¯**
- **ä¸ç»è¿‡æ•°æ®åº“**ï¼Œç›´æ¥ç»™LLM

**è¯æ®ä½ç½®**ï¼š`ScraperAdapter` åœ¨ `stocks.py` L641-655 è¢«è°ƒç”¨ï¼Œè¿”å›çš„æ–°é—»ç›´æ¥ç”¨äºåˆ†æ

### 2ï¸âƒ£ **è¿›å…¥æ•°æ®åº“**ï¼ˆåå°å®šæ—¶ä»»åŠ¡ï¼‰â°

- **å®šæ—¶ä»»åŠ¡**ï¼ˆä¸æ˜¯å³æ—¶åˆ†æè§¦å‘çš„ï¼‰ä¼šæŠŠæ–°é—»åŒæ­¥åˆ°æ•°æ®åº“
- è¿™ä¸ªæ˜¯ä¸ºäº†ä¸‹æ¬¡åˆ†ææ—¶èƒ½ä»æ•°æ®åº“å¿«é€Ÿè¯»å–ï¼ˆç¼“å­˜ä½œç”¨ï¼‰

**è¯æ®ä½ç½®**ï¼š`akshare_sync_service.py` çš„å®šæ—¶ä»»åŠ¡

---

## ğŸ“‹ å®Œæ•´æµç¨‹å›¾

```
ç”¨æˆ·è¾“å…¥"å°ç±³é›†å›¢" â†’ ç‚¹å‡»åˆ†æ
          â†“
   å‰ç«¯å‘é€è¯·æ±‚åˆ°åç«¯ API
          â†“
   åç«¯è°ƒç”¨ UnifiedNewsAnalyzer
          â†“
   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
   â†“           â†“
ã€å³æ—¶æ•°æ®æºã€‘   ã€æ•°æ®åº“ç¼“å­˜ã€‘
â”œ ä¸œæ–¹è´¢å¯Œ      â”” å†å²æ–°é—»
â”œ å¤šæºå¿«è®¯         (ä¸Šæ¬¡åŒæ­¥çš„)
â”œ Serperæœç´¢
â”œ RSSæº
â”” playwriteOCRçˆ¬è™« â† å³æ—¶è°ƒç”¨9527ç«¯å£
   (8ä¸ªçˆ¬è™«å¹¶è¡Œ)
          â†“
   æ‰€æœ‰æ•°æ®èåˆå»é‡
          â†“
   è£…å¡«è¿›æç¤ºè¯
          â†“
   å‘é€ç»™ DeepSeek/GPT
          â†“
   ç”Ÿæˆåˆ†ææŠ¥å‘Š
          â†“
   è¿”å›ç»™å‰ç«¯æ˜¾ç¤º
```

---

## ğŸ”‘ å…³é”®ç»“è®º

1. âœ… **çˆ¬è™«æ•°æ®å³æ—¶è·å–**ï¼šä½ åˆ†ææ—¶ä¼šå®æ—¶è°ƒç”¨playwriteOCRçš„8ä¸ªçˆ¬è™«
2. âœ… **6ä¸ªæ•°æ®æºå¹¶è¡Œ**ï¼šä¸æ­¢çˆ¬è™«ï¼Œè¿˜æœ‰ä¸œæ–¹è´¢å¯Œã€Serperã€RSSç­‰5ä¸ªæºåŒæ—¶å·¥ä½œ
3. âœ… **æ•°æ®åº“åªæ˜¯è¡¥å……**ï¼šæ•°æ®åº“é‡Œçš„å†å²æ–°é—»åªæ˜¯æ’åœ¨æœ€åï¼ˆä¼˜å…ˆçº§6ï¼‰ï¼Œç”¨æ¥è¡¥å……å®æ—¶æ•°æ®
4. âœ… **ä¸ç»è¿‡æ•°æ®åº“ç›´è¾¾LLM**ï¼šçˆ¬è™«è¿”å›çš„æ•°æ®ç›´æ¥è£…è¿›æç¤ºè¯ï¼Œä¸ç”¨å…ˆå­˜æ•°æ®åº“

---

## ğŸ’¡ è¡¥å……è¯´æ˜

### æ•°æ®åº“çš„ä½œç”¨

- å®šæ—¶ä»»åŠ¡ï¼ˆä¾‹å¦‚æ¯å°æ—¶ï¼‰ä¼šæŠŠæ–°é—»åŒæ­¥åˆ°æ•°æ®åº“
- å¦‚æœæŸä¸ªæ•°æ®æºå¤±è´¥äº†ï¼Œå¯ä»¥ä»æ•°æ®åº“è¯»å†å²æ•°æ®å…œåº•
- ä½†ä¸»è¦è¿˜æ˜¯**å³æ—¶é‡‡é›†ä¸ºä¸»**ï¼Œæ•°æ®åº“ä¸ºè¾…

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ ä¼šçœ‹åˆ°ä»£ç é‡Œæœ‰ `ScraperAdapter` è¢«ç›´æ¥è°ƒç”¨çš„åŸå› â€”â€”å®ƒä¸æ˜¯å­˜æ•°æ®åº“å†è¯»å–,è€Œæ˜¯å³æ—¶è·å–å³æ—¶ç”¨ï¼

---

## ğŸ“‚ ä»£ç è¯æ®ä½ç½®

### ä¸»è¦æ–‡ä»¶

1. **[unified_news_tool.py](file:///anti/ak-trading/TradingAgents-arm32/tradingagents/tools/unified_news_tool.py)**
   - L813-950: `_get_hk_share_news()` å‡½æ•° - æ¸¯è‚¡æ–°é—»å¹¶è¡Œé‡‡é›†
   - L830-853: ä¸œæ–¹è´¢å¯Œä¸ªè‚¡æ–°é—»
   - L855-866: AKShareå¤šæºå¿«è®¯
   - L868-878: Serperå®æ—¶æœç´¢
   - L880-898: Alpha Vantageï¼ˆä»…ç¾è‚¡ï¼‰
   - L900-937: RSSæ–°é—»æº
   - L939-948: æ•°æ®åº“å†å²ç¼“å­˜

2. **[stocks.py](file:///anti/ak-trading/TradingAgents-arm32/app/routers/stocks.py)**
   - L641-655: ScraperAdapterè°ƒç”¨ä½ç½®

3. **[scraper_adapter.py](file:///anti/ak-trading/TradingAgents-arm32/app/worker/news_adapters/scraper_adapter.py)**
   - å®Œæ•´æ–‡ä»¶ï¼šPlaywriteOCRçˆ¬è™«é€‚é…å™¨
   - L28-78: `get_news()` æ–¹æ³• - HTTPè°ƒç”¨9527ç«¯å£

### PlaywriteOCRé¡¹ç›®

4. **[app.py](file:///anti/playwriteOCR/app.py)**
   - L428-509: `/api/v1/news` æ¥å£ - 8ä¸ªçˆ¬è™«APIç«¯ç‚¹
   - L19-28: SCRAPERSé…ç½® - 8ä¸ªçˆ¬è™«å®šä¹‰

---

## ğŸ”„ æ•°æ®æµè¯¦ç»†è¯´æ˜

### UnifiedNewsAnalyzerå·¥ä½œæµç¨‹

```python
# unified_news_tool.py L813-950

def _get_hk_share_news(self, stock_code: str, max_news: int, model_info: str = "") -> str:
    """æ¸¯è‚¡æ–°é—» - å¹¶è¡Œèåˆç­–ç•¥"""
    
    # æ•°æ®æº1: ä¸œæ–¹è´¢å¯Œä¸ªè‚¡æ–°é—»ï¼ˆæœ€æ–°ï¼‰
    provider.stock_news_em(symbol=clean_code)
    
    # æ•°æ®æº2: AKShareå¤šæºå¿«è®¯ï¼ˆå®æ—¶ï¼‰
    provider.get_multi_source_news(limit_per_source=5)
    
    # æ•°æ®æº3: Serperå®æ—¶æœç´¢
    self._search_news_with_serper(query, period="qdr:d")
    
    # æ•°æ®æº4: Alpha Vantageï¼ˆä»…ç¾è‚¡ï¼‰
    get_alpha_vantage_news(ticker=stock_code, limit=10)
    
    # æ•°æ®æº5: RSSæ–°é—»æº
    rss_adapter.get_news(symbol=stock_code, limit=15)
    
    # æ•°æ®æº6: æ•°æ®åº“å†å²ç¼“å­˜ï¼ˆè¡¥å……ï¼‰
    self._get_news_from_database(stock_code, 15, company_name)
    
    # èåˆæ‰€æœ‰æ•°æ®æºï¼Œå»é‡åè¿”å›
```

### ScraperAdapterå·¥ä½œæµç¨‹

```python
# scraper_adapter.py L28-78

async def get_news(self, symbol: str, limit: int = 20) -> List[Dict[str, Any]]:
    """è·å–æŒ‡å®šè‚¡ç¥¨çš„æ–°é—»"""
    
    # è°ƒç”¨çˆ¬è™«API
    url = f"{self.api_url}/api/v1/news"  # http://172.20.0.1:9527
    params = {
        "keyword": symbol,
        "limit": limit
        # sources ä¸ä¼ ï¼Œé»˜è®¤é‡‡é›†å…¨éƒ¨ 8 ä¸ªæº
    }
    
    async with aiohttp.ClientSession() as session:
        async with session.get(url, params=params, timeout=300) as resp:
            data = await resp.json()
            raw_news_list = data.get("data", [])
            
            # è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼
            news_list = []
            for raw_news in raw_news_list:
                normalized = self.normalize_news(raw_news)
                news_list.append(normalized)
            
            return news_list
```

---

## ğŸ¯ å®é™…è¿è¡Œç¤ºä¾‹

### ç”¨æˆ·æ“ä½œ
```
å‰ç«¯è¾“å…¥: 01810.HK (å°ç±³é›†å›¢)
ç‚¹å‡»: "å¼€å§‹åˆ†æ"
```

### åç«¯æ‰§è¡Œ
```
1. UnifiedNewsAnalyzer.get_stock_news_unified("01810.HK")
2. è¯†åˆ«è‚¡ç¥¨ç±»å‹ â†’ æ¸¯è‚¡
3. è°ƒç”¨ _get_hk_share_news()
4. å¹¶è¡Œè°ƒç”¨6ä¸ªæ•°æ®æº:
   â”œâ”€ ä¸œæ–¹è´¢å¯Œ: 10æ¡æ–°é—»
   â”œâ”€ å¤šæºå¿«è®¯: 35æ¡æ–°é—»ï¼ˆ7ä¸ªæºÃ—5æ¡ï¼‰
   â”œâ”€ Serper: 10æ¡æ–°é—»
   â”œâ”€ RSSæº: 15æ¡æ–°é—»
   â”œâ”€ playwriteOCR: é€šè¿‡ScraperAdapterè°ƒç”¨8ä¸ªçˆ¬è™«
   â”‚  â”œâ”€ ä¸œæ–¹è´¢å¯Œçˆ¬è™«: 20æ¡
   â”‚  â”œâ”€ æ ¼éš†æ±‡: 20æ¡
   â”‚  â”œâ”€ æ™ºé€šè´¢ç»: 20æ¡
   â”‚  â”œâ”€ å¯Œé€”æ–°é—»: 60-180æ¡
   â”‚  â”œâ”€ å¯Œé€”ç ”æŠ¥: 30æ¡
   â”‚  â”œâ”€ è´¢è”ç¤¾: 20æ¡
   â”‚  â”œâ”€ åå°”è¡—è§é—»: 39æ¡
   â”‚  â””â”€ ä»Šæ—¥å¤´æ¡: 100æ¡
   â””â”€ æ•°æ®åº“: 15æ¡å†å²æ–°é—»
5. èåˆå»é‡ (NewsDeduplicator)
6. ç”Ÿæˆæç¤ºè¯ (6000-12000å­—ç¬¦)
7. å‘é€ç»™ DeepSeek/GPT
8. è¿”å›åˆ†ææŠ¥å‘Š
```

### æ•°æ®é‡ç»Ÿè®¡
```
åŸå§‹é‡‡é›†: ~500æ¡æ–°é—»
å»é‡å: ~150æ¡æ–°é—»
æç¤ºè¯é•¿åº¦: 6000-12000å­—ç¬¦
ç”ŸæˆæŠ¥å‘Š: 2000-3000å­—ç¬¦
```

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

- [notes.md - æ–°é—»æ•°æ®æµç¨‹æ¶æ„ç« èŠ‚](file:///anti/ak-trading/notes.md#L434-L507)
- [TODO.md - æˆåŠŸç»éªŒç« èŠ‚](file:///anti/ak-trading/TODO.md#L191-L224)
- [PlaywriteOCRé›†æˆä¼˜åŒ–è®¡åˆ’](file:///anti/ak-trading/PlaywriteOCRé›†æˆä¼˜åŒ–è®¡åˆ’.md)
- [é¡¹ç›®æ¶æ„å›¾](file:///anti/ak-trading/é¡¹ç›®æ¶æ„å›¾.md)

---

## ğŸ” é•¿æœŸè®°å¿†å­˜å‚¨

æ­¤æ¶æ„çŸ¥è¯†å·²å­˜å…¥ `m.py` æ•°æ®åº“ï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ£€ç´¢ï¼š

```bash
python3 m.py search "æ–°é—»æ•°æ®æµç¨‹"
python3 m.py search "ScraperAdapter"
python3 m.py search "6ä¸ªæ•°æ®æº"
```

---

**æ–‡æ¡£ç»“æŸ** - 2026-01-18 20:21
