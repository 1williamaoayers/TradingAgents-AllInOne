# 🔄 重置与纠偏流程

## 触发条件
- 用户说"跑偏了"、"重置"、"回到正轨"
- 用户说"你在干什么"、"停"
- Agent 发现自己偏离任务目标

---

## 核心原则
**立即停止，重新对齐目标**

---

## 执行步骤

### 步骤1：立即停止当前操作
- 停止所有正在进行的工作
- 不要继续执行当前任务
- 不要试图解释为什么跑偏

### 步骤2：重新读取上下文

#### 2.1 读取 TODO.md
```
view_file TODO.md
```
- 找到当前应该做的任务（最上面的 `[ ]`）
- 确认任务的具体内容

#### 2.2 读取 notes.md 最后 50 行
```
view_file notes.md (最后50行)
```
- 查看最近的工作记录
- 找到最后一次 SESSION HANDOVER
- 确认上次的进度和下一步计划

#### 2.3 询问用户
```
我发现可能跑偏了，让我重新确认：

**TODO.md 显示的任务**：[具体任务内容]
**notes.md 最后记录**：[最后的工作内容]

**我刚才在做**：[我刚才在做什么]

请问你希望我：
1. 继续 TODO.md 的任务
2. 继续 notes.md 记录的工作
3. 做其他事情（请说明）
```

### 步骤3：等待用户明确指令
- 不要猜测用户想要什么
- 不要自作主张继续工作
- 等待用户明确说明下一步

### 步骤4：记录跑偏原因
在 `notes.md` 中记录：
```markdown
## 🔄 RESET - [时间]
- **跑偏原因**：[为什么会跑偏]
- **原本应该做**：[TODO.md 的任务]
- **实际在做**：[我跑偏去做了什么]
- **用户指令**：[用户让我做什么]
- **纠正措施**：[如何避免再次跑偏]
```

### 步骤5：重新开始
- 按照用户的明确指令执行
- 每完成一小步就确认："这样对吗？"
- 频繁检查是否还在正轨上

---

## 常见跑偏场景

### 场景1：任务蔓延
```
用户："修复登录 bug"
我：开始修复 → 发现数据库问题 → 开始重构数据库 → 开始优化性能 → ...

❌ 跑偏了！原本只是修 bug，现在在重构整个系统
```

**纠偏**：
1. 停止重构
2. 回到"修复登录 bug"
3. 只修这一个 bug
4. 其他问题记录到 notes.md，以后再说

### 场景2：过度优化
```
用户："实现用户注册功能"
我：实现基础功能 → 添加邮箱验证 → 添加手机验证 → 添加社交登录 → ...

❌ 跑偏了！用户只要基础注册，我在加一堆额外功能
```

**纠偏**：
1. 停止添加功能
2. 回到"基础注册功能"
3. 只实现最小可用版本
4. 额外功能记录到 TODO.md，等用户要求

### 场景3：分析瘫痪
```
用户："添加一个按钮"
我：分析架构 → 研究最佳实践 → 对比多种方案 → 写设计文档 → ...

❌ 跑偏了！简单任务复杂化，一直在分析不动手
```

**纠偏**：
1. 停止分析
2. 回到"添加按钮"
3. 直接实现，不要过度设计
4. 简单任务简单做

### 场景4：工具调用失控
```
用户："检查配置文件"
我：读取 config.json → 读取 .env → 读取 package.json → 读取 tsconfig.json → ...

❌ 跑偏了！用户只要检查一个文件，我在读所有文件
```

**纠偏**：
1. 停止读取
2. 问用户："你要检查哪个配置文件？"
3. 只读那一个文件

---

## 自检清单

在执行任务过程中，定期问自己：

- [ ] 我现在做的事情，是 TODO.md 里的任务吗？
- [ ] 我现在做的事情，是用户刚才要求的吗？
- [ ] 我是不是在做用户没要求的额外工作？
- [ ] 我是不是在过度优化/过度分析？
- [ ] 我是不是调用了太多工具？

**如果任何一项是 NO 或不确定，立即触发重置流程**

---

## 防止跑偏的原则

### 1. 最小化原则
- 只做用户要求的最小范围
- 不要自作主张添加功能
- 不要"顺便"做其他事情

### 2. 频繁确认原则
- 每完成一小步就问："这样对吗？"
- 不确定时立即问用户
- 不要猜测用户的意图

### 3. 单一任务原则
- 一次只做一个任务
- 完成后再做下一个
- 不要同时做多个任务

### 4. 记录而非执行原则
- 发现其他问题？记录到 notes.md
- 想到改进点？记录到 TODO.md
- 不要立即去做

---

## 用户纠偏命令

| 用户说 | 我的反应 |
|-------|---------|
| "跑偏了" | 立即执行本工作流 |
| "停" | 立即停止，等待指令 |
| "回到正轨" | 重新读取 TODO.md 和 notes.md |
| "你在干什么" | 说明当前在做什么，等待确认 |
| "不是这个" | 停止当前工作，询问应该做什么 |
| "重置" | 执行完整的重置流程 |

---

## 示例对话

### 好的纠偏示例
```
用户："跑偏了"

我：
"⚠️ 收到，立即停止。

让我重新确认：
- TODO.md 任务：实现用户登录功能
- 我刚才在做：重构整个数据库架构

确实跑偏了，抱歉。

请问你希望我：
1. 回到'实现用户登录功能'
2. 继续数据库重构
3. 做其他事情

请明确指示。"
```

### 不好的纠偏示例
```
用户："跑偏了"

我：
"没有跑偏啊，我在优化性能，这对登录功能很重要..."

❌ 不要辩解，不要解释，立即停止
```

---

## 记住

- **用户说跑偏了 = 就是跑偏了**
- 不要辩解，不要解释
- 立即停止，重新对齐
- 等待明确指令再继续
